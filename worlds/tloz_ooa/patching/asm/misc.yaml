
# remove the entire crescent island storm / tokay theft sequence.
09/5731/: jp $582a             # tokays stealing items
09/5756/: jp $582a             # ^
09/57a5/: |                    # ^
  inc a
  inc a         
0a/4fe1/: jp interactionDelete # ^
0a/623a/: |                    # tokay trader stolen items
  or a 
  or a
  or a     
0a/62d7/: |                    # ^
  or a 
  or a
  or a     
0b/52e3/: jp interactionDelete # storm
12/638f/: db $f3,$57,$41,$ff   # item in chicken hut

15//bombFairyCall: |
  ld a,$1c # GLOBALFLAG_GOT_BOMB_UPGRADE_FROM_FAIRY
  call setGlobalFlag
  ld bc,locations.bombFairy
  call spawnTreasureOnLink
  ret

# Bomb fairy replacement
15/7061/: |
  db $e0
  dw bombFairyCall
  db $00                  # End script

# make guy in front of d2 go away if you have bombs.
09/5242/: |
    ld a,$03
    call checkTreasureObtained
    jp c,interactionDelete
# and center him on a tile so you can't get stuck in a currents loop.
12/611c/: db 48

# stop d6 boss key chest from setting past boss key flag.
10/793c/: | 
  ret
  nop
  nop
  
# first and second time portals (near maku tree) are always active.
10/7d4e/: jr nz,$00 # present -> past
10/7d57/: jr c,$00  # past -> present

# allow harvesting seeds from trees with either shooter or satchel.
11//checkCanHarvestSeeds: |
    call checkTreasureObtained
    ret c
    ld a,TREASURE_SHOOTER
    jp checkTreasureObtained
11/4aba/: call checkCanHarvestSeeds
  
# remove the usual deku soldier event (taken to palace etc).
12/58f5/: ret
# cut off end of soldier's text so it makes sense when giving item.
23/6656/: db 00
# position the "you may go now" text correctly on screen.
23/65d8/: db 00


# prevent bridge-building foreman from setting flag 22 so that animal/flute
# event doesn't happen in fairies' woods.
15/75bf/: db setglobalflag,a2 # bit 7 = unset flag


# use different seed capacity table, so that level zero satchel can still
# hold 20 seeds.
3f//seedCapacityTable: |
    db 20,20,50,99
3f/4607/: ld hl,seedCapacityTable

# don't equip sword in shooting gallery if link doesn't have it. it wouldn't
# work anyway.
15//setShootingGalleryEquips: |
    ld a,TREASURE_SWORD
    call checkTreasureObtained
    ld a,$00
    ldi (hl),a
    ret nc
    dec hl
    ld a,TREASURE_SWORD
    ldi (hl),a
    ret
15/50ae/: call setShootingGalleryEquips

# Handle D8 slate staircase
0a//d8SlateStaircaseHandle : |
  ; Check if it's the right stair (not sure if the check is necessary)
  ld a,(hl) 
  and $0f
  call getNumSetBits
  cp option.required_slates
  ret

0a/70f9/: |
  call d8SlateStaircaseHandle
  nop
  nop
  ;ret nz

0b//d8removeSlateIfStairOpen : |
  ld a,$0a  ; What the call replaced
  ld (de),a

  call getThisRoomFlags
  bit 6,a
  jp nz,interactionDelete
  ret  

0b/7f80/ : |
  call d8removeSlateIfStairOpen

# Make Rafton skip the raft explanation 
# (by checking the room flag instead of the 3rd essence)
15/6b43/: dw $c71f
15/6b45/: db $ff

# Sea of storm specific chest. (change if in linked game)
10/79ab/: dwbe locations.seaofstorm
10/79ad/: dwbe locations.seaofstorm

# Veran is beaten
10//thatallfolks: |
  ld a,GLOBALFLAG_VERAN_BEATEN
  call setGlobalFlag
  call incMakuTreeState
  ret
10/5aae/: call thatallfolks